<!--
@license
Copyright 2015 Mason Louchart

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../iron-signals/iron-signals.html">

<!--
`paper-toast` with some swagg features.

The toaster has a bin, where all signals are stored. This allows for multiple
signals to be received at once, and they will be fulfilled in order of their
receipt. Separate configurations are still maintained for each signal.

There are 4 types of toast (info, success, warning and error) that can be
selected using the `type` property. Each type sets a light at the bottom of the
toast according to the level of danger.

You can also set the heat level (low, middle or high) using the `heat` property.
The toast blinks more or less rapidly according to the defined level.

The toaster's shelf, or position, can be set using the `shelf` property.
Possible values include bottom-left (default), bottom-right, top-left and
top-right.
<br>

### Example

Just put the tag in the index page...

    <toast-er></toast-er>
    <toast-er duration="5000"></toast-er>
    <toast-er type="info"></toast-er>
    <toast-er type="warning" heat="middle"></toast-er>
    <toast-er shelf="top-right"></toast-er>

...and fire some events, that's all!

    <script>
    function someMethod() {
      this.fire('iron-signal', {
        name: 'toaster-bake',
        data: {
          text: 'You are not allowed to do this.',
          type: 'error',
          duration: 5000,
          heat: 'high',
          shelf: 'top-right'
        }
      });
    }
    </script>

There are no required options excepted `text`!
<br><br>

## Audited events

Name                       | Description
:--------------------------|:-----------
`iron-signal-toaster-bake` | Shows the toast with received data

## Event detail properties

Property     | Value           | Description
:------------|:----------------|:------------
`buttonEvent`| 'event-name'    | Event to fire when the button is pressed
`buttonText` | 'button text'   | The text shown on the button, also toggles it
`duration`   | 5000            | Sets the toast duration to 5 seconds (default: 3000)
`heat`       | 'low'           | The toaster blinks with a transition in 3 seconds
             | 'middle'        | The toaster blinks with a transition in 2 seconds
             | 'high'          | The toaster blinks with a transition in 1 second
`shelf`      | 'top-right'     | Sets the toaster position to the top-right corner
             | 'top-left'      | Sets the toaster position to the top-left corner
             | 'bottom-right'  | Sets the toaster position to the bottom-right corner
             | 'bottom-left'   | Sets the toaster position to the bottom-left corner
`text`       | 'toaster text'  | The text shown by the toaster
`type`       | 'info'          | Sets the color of toaster bottom to #00baff (cyan)
             | 'success'       | Sets the color of toaster bottom to #0bdb00 (green)
             | 'warning'       | Sets the color of toaster bottom to #ffa800 (orange)
             | 'error'         | Sets the color of toaster bottom to #fb0000 (red)

@element toast-er
@demo
@blurb `paper-toast` with some swagg features.
@homepage https://LM450N.github.io/toast-er/
-->
<dom-module id="toast-er">
  <style>
  :host {
    display: inline-block;
    box-sizing: border-box;
    position: fixed;
  }
  :host.top paper-toast {
    top: 0;
    transform: translateY(-100px);
  }
  :host.top paper-toast.paper-toast-open {
    top: 12px;
    transform: translateY(0px);
  }
  #button {
    position: absolute;
    top: 4px; bottom: 4px; right: 0;
    z-index: 1;
  }
  #grill {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 4px;
  }
  .info {
    background-color: rgb(0, 186, 255);
  }
  .success {
    background-color: rgb(11, 219, 0);
  }
  .warning {
    background-color: rgb(255, 168, 0);
  }
  .error {
    background-color: rgb(251, 0, 0);
  }
  @-webkit-keyframes cooking {
    from {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  @keyframes cooking {
    from {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  .low {
    -webkit-animation: cooking 3s linear 0.2s infinite;
    animation: cooking 3s linear 0.2s infinite;
  }
  .middle {
    -webkit-animation: cooking 2s linear 0.2s infinite;
    animation: cooking 2s linear 0.2s infinite;
  }
  .high {
    -webkit-animation: cooking 1s linear 0.2s infinite;
    animation: cooking 1s linear 0.2s infinite;
  }
  </style>

  <template>
      <paper-toast id="toast">
        <paper-button id="button" on-tap="_buttonTap" hidden></paper-button>
        <span id="grill"></span>
    </paper-toast>
    <iron-signals on-iron-signal-toaster-bake="_bake"></iron-signals>
  </template>

  <script>
  (function() {
    Polymer({

      is: 'toast-er',

      properties: {
        /**
         * Text to display.
         *
         * @type {String}
         * @default
         */
        text: {
          type: String
        },

        /**
         * Button text to display.
         *
         * @type {String}
         * @default
         */
        buttonText: {
          type: String,
          value: ""
        },

        /**
         * Event to fire when the button is pressed.
         *
         * @type {String}
         * @default
         */
        buttonEvent: {
          type: String,
          value: "button-pressed"
        },

        /**
         * Duration of displaying.
         *
         * @type {Number}
         * @default 3000
         */
        duration: {
          type: Number,
          value: 3000
        },

        /**
         * Type of toaster. (success | info | warning | error)
         *
         * @type {String}
         * @default
         */
        type: {
          type: String
        },

        /**
         * Defines the speed of blinking of the toast's underline.
         * (low | middle | high)
         *
         * @type {String}
         * @default
         */
        heat: {
          type: String
        },

        /**
         * Sets the toaster position.
         * (top-right | top-left | bottom-right | bottom-left)
         *
         * @type {String}
         * @default
         */
        shelf: {
          type: String
        },

        /**
         * Stack of breads.
         *
         * @type {Array}
         */
        _breads: {
          type: Array,
          value: function() {
            return [];
          }
        }
      },

      /**
       * Shows the toast then `_emptyTheToaster`.
       *
       * @param {Object} event  iron-signal-toaster-bake
       * @param {Object} bread  to bake can contains `text` {String},
       * `type` {String}, `duration` {Number}, `heat` {String} and `shelf` {String}
       */
      _bake: function(event, bread) {
        var text = bread.text || this.text;
        if (text && text.trim().length) {
          this.push('_breads', bread);
          this._emptyTheToaster();
        }
      },

      _buttonTap: function(event) {
        this.fire("toaster-" + event.target.buttonEvent);
      },

      /**
       * Shows message by unstacking of toasts.
       */
      _emptyTheToaster: function() {
        // Turn off the toaster if the queue is empty.
        if (!this._breads.length) {
          this.async(function() {
            this._turnOffTheToaster();
          }, 1000);
          return;
        }

        // Get configuration of the toast.
        var bread = this._breads[0],
          buttonEvent = bread.buttonEvent || this.buttonEvent,
          buttonText = bread.buttonText || this.buttonText,
          hasButton = buttonText.length != 0,
          duration = bread.duration || (hasButton ? 10000 : this.duration),
          heat = bread.heat || this.heat,
          shelf = bread.shelf || this.shelf,
          text = bread.text || this.text,
          type = bread.type || this.type,
          toast = this.$.toast;

        // Shows the toast.
        if (!toast.opened) {
          var button = this.$.button;
          this.shift('_breads');

          toast.duration = duration;
          toast.text = text;
          button.hidden = !hasButton;
          button.buttonEvent = buttonEvent;
          button.textContent = buttonText;

          this._turnOnTheToaster(type, heat, shelf);
          this.async(function() {
            toast.show();
          }, 100);
        }

        // Queue the next toast.
        this.async(function() {
          this._emptyTheToaster();
        }, duration + 500);
      },

      /**
       * Sets the toaster bottom color according to the given type, defines the
       * blinking speed and sets the toast position.
       *
       * @param  {String} type  (info | success | warning | error) defines the toaster bottom color
       * @param  {String} heat  (low | middle | high) defines the blinking speed
       * @param  {String} shelf (top-left, top-right, bottom-left, bottom-right) defines the toaster position
       */
      _turnOnTheToaster: function(type, heat, shelf) {
        var grill = this.$.grill,
          toast = this.$.toast;

        // Set the grill type.
        type = type && type.toLowerCase() || '';
        this.toggleClass('info', type === 'info', grill);
        this.toggleClass('success', type === 'success', grill);
        this.toggleClass('warning', type === 'warning', grill);
        this.toggleClass('error', type === 'error', grill);

        // Set the grill power.
        heat = heat && heat.toLowerCase() || '';
        this.toggleClass('low', heat === 'low', grill);
        this.toggleClass('middle', heat === 'middle', grill);
        this.toggleClass('high', heat === 'high', grill);

        // Set the toaster position.
        shelf = shelf && shelf.toLowerCase().split('-') || [];
        toast.horizontalAlign = shelf[1] || 'left';
        toast.verticalAlign = shelf[0] || 'bottom';
        this.toggleClass('top', toast.verticalAlign === 'top');
      },

      /**
       * Disables toaster bottom color and blinking.
       */
      _turnOffTheToaster: function() {
        var grill = this.$.grill;
        this.toggleClass('low', false, grill);
        this.toggleClass('middle', false, grill);
        this.toggleClass('high', false, grill);
      }

    });
  })();
  </script>
</dom-module>
